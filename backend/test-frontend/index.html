<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumen Backend Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .response.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .response.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .status.connected {
            background: #d4edda;
            color: #155724;
        }

        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tabs-small {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-small {
            padding: 8px 16px;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            border-bottom: 2px solid transparent;
            margin-right: 5px;
            font-size: 14px;
            border-radius: 4px 4px 0 0;
        }

        .tab-small.active {
            background: #667eea;
            color: white;
            border-bottom-color: #667eea;
        }

        .journal-tab-content {
            display: block;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        #recordingStatus {
            font-style: italic;
            color: #666;
        }

        .recording {
            background: #dc3545 !important;
            color: white !important;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-btn {
            background: #e9ecef;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Lumen Backend Test Interface</h1>
            <p>Comprehensive testing for emotions, journaling, analytics, and AI insights</p>
        </div>

        <div class="content">
            <!-- Connection Status -->
            <div class="section">
                <h2>üîó Connection Status</h2>
                <div class="grid">
                    <div class="card">
                        <h3>API Health</h3>
                        <div id="healthStatus" class="status disconnected">Checking...</div>
                        <button class="btn" onclick="checkHealth()">Check Health</button>
                        <div id="healthResponse" class="response"></div>
                    </div>
                    <div class="card">
                        <h3>Authentication</h3>
                        <div id="authStatus" class="status disconnected">Not Authenticated</div>
                        <input type="text" id="clerkId" placeholder="Enter Clerk ID for testing" value="test_user_123">
                        <button class="btn" onclick="setAuth()">Set Test User</button>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="showTab('emotions')">üòä Emotions</div>
                <div class="tab" onclick="showTab('journal')">üìù Journal</div>
                <div class="tab" onclick="showTab('analytics')">üìä Analytics</div>
                <div class="tab" onclick="showTab('clinical')">üè• Clinical</div>
                <div class="tab" onclick="showTab('ai')">ü§ñ AI Insights</div>
                <div class="tab" onclick="showTab('games')">üéÆ Games</div>
            </div>

            <!-- Emotions Tab -->
            <div id="emotions" class="tab-content active">
                <div class="section">
                    <h2>üòä Emotion Management</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="createEmotion('happy', 8)">Happy (8)</button>
                        <button class="quick-btn" onclick="createEmotion('sad', 5)">Sad (5)</button>
                        <button class="quick-btn" onclick="createEmotion('anxiety', 7)">Anxiety (7)</button>
                        <button class="quick-btn" onclick="createEmotion('stress', 6)">Stress (6)</button>
                        <button class="quick-btn" onclick="createEmotion('loneliness', 4)">Loneliness (4)</button>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h3>Create Emotion Entry</h3>
                            <div class="form-group">
                                <label>Emotion:</label>
                                <select id="emotionType">
                                    <option value="happy">Happy</option>
                                    <option value="sad">Sad</option>
                                    <option value="loneliness">Loneliness</option>
                                    <option value="anxiety">Anxiety</option>
                                    <option value="frustration">Frustration</option>
                                    <option value="stress">Stress</option>
                                    <option value="lethargy">Lethargy</option>
                                    <option value="fear">Fear</option>
                                    <option value="grief">Grief</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Intensity (1-10, optional - defaults to 5):</label>
                                <input type="number" id="emotionIntensity" min="1" max="10" placeholder="5">
                            </div>
                            <div class="form-group">
                                <label>Context (optional):</label>
                                <textarea id="emotionContext" placeholder="What's happening?"></textarea>
                            </div>
                            <button class="btn" onclick="createEmotionEntry()">Create Entry</button>
                            <div id="emotionResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>Get Emotion Entries</h3>
                            <div class="form-group">
                                <label>Days:</label>
                                <input type="number" id="emotionDays" value="30">
                            </div>
                            <div class="form-group">
                                <label>Emotion Filter:</label>
                                <select id="emotionFilter">
                                    <option value="">All Emotions</option>
                                    <option value="happy">Happy</option>
                                    <option value="sad">Sad</option>
                                    <option value="anxiety">Anxiety</option>
                                    <option value="stress">Stress</option>
                                </select>
                            </div>
                            <button class="btn" onclick="getEmotions()">Get Entries</button>
                            <button class="btn btn-secondary" onclick="getDailyEmotions()">Daily Summary</button>
                            <div id="emotionsListResponse" class="response"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journal Tab -->
            <div id="journal" class="tab-content">
                <div class="section">
                    <h2>üìù Journal Management</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="createJournal('happy', 'Had a great day today!')">Happy Entry</button>
                        <button class="quick-btn" onclick="createJournal('sad', 'Feeling down today.')">Sad Entry</button>
                        <button class="quick-btn" onclick="createJournal('anxiety', 'Worried about upcoming presentation.')">Anxiety Entry</button>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h3>Create Journal Entry</h3>
                            <div class="tabs-small">
                                <div class="tab-small active" onclick="showJournalTab('text')">üìù Text</div>
                                <div class="tab-small" onclick="showJournalTab('audio')">üéôÔ∏è Audio</div>
                            </div>
                            
                            <!-- Text Journal Entry -->
                            <div id="textJournal" class="journal-tab-content">
                                <div class="form-group">
                                    <label>Mood:</label>
                                    <select id="journalMood">
                                        <option value="happy">Happy</option>
                                        <option value="sad">Sad</option>
                                        <option value="loneliness">Loneliness</option>
                                        <option value="anxiety">Anxiety</option>
                                        <option value="frustration">Frustration</option>
                                        <option value="stress">Stress</option>
                                        <option value="lethargy">Lethargy</option>
                                        <option value="fear">Fear</option>
                                        <option value="grief">Grief</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Content:</label>
                                    <textarea id="journalContent" placeholder="Write your thoughts..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Tags (comma-separated):</label>
                                    <input type="text" id="journalTags" placeholder="work, stress, family">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="journalPrivate" checked> Private Entry
                                    </label>
                                </div>
                                <button class="btn" onclick="createJournalEntry()">Create Entry</button>
                            </div>
                            
                            <!-- Audio Journal Entry -->
                            <div id="audioJournal" class="journal-tab-content" style="display: none;">
                                <div class="form-group">
                                    <label>Mood:</label>
                                    <select id="audioJournalMood">
                                        <option value="happy">Happy</option>
                                        <option value="sad">Sad</option>
                                        <option value="loneliness">Loneliness</option>
                                        <option value="anxiety">Anxiety</option>
                                        <option value="frustration">Frustration</option>
                                        <option value="stress">Stress</option>
                                        <option value="lethargy">Lethargy</option>
                                        <option value="fear">Fear</option>
                                        <option value="grief">Grief</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Audio Recording:</label>
                                    <div class="audio-controls">
                                        <button id="recordBtn" class="btn" onclick="toggleRecording()">üéôÔ∏è Start Recording</button>
                                        <span id="recordingStatus">Ready to record</span>
                                    </div>
                                    <input type="file" id="audioFile" accept="audio/*" style="margin-top: 10px;">
                                    <small>Record audio or upload an audio file (MP3, WAV, etc.)</small>
                                </div>
                                <div class="form-group">
                                    <label>Tags (comma-separated):</label>
                                    <input type="text" id="audioJournalTags" placeholder="work, stress, family">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="audioJournalPrivate" checked> Private Entry
                                    </label>
                                </div>
                                <button class="btn" onclick="createAudioJournalEntry()" id="createAudioBtn">Create Audio Entry</button>
                            </div>
                            
                            <div id="journalResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>Get Journal Entries</h3>
                            <div class="form-group">
                                <label>Days:</label>
                                <input type="number" id="journalDays" value="30">
                            </div>
                            <div class="form-group">
                                <label>Include Private:</label>
                                <select id="journalPrivateFilter">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <button class="btn" onclick="getJournalEntries()">Get Entries</button>
                            <button class="btn btn-secondary" onclick="searchJournal()">Search</button>
                            <div id="journalListResponse" class="response"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="section">
                    <h2>üìä Analytics & Insights</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="getAnalyticsOverview()">Overview</button>
                        <button class="quick-btn" onclick="getEmotionAnalytics()">Emotion Stats</button>
                        <button class="quick-btn" onclick="getTrends()">Trends</button>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h3>Analytics Overview</h3>
                            <div class="form-group">
                                <label>Days:</label>
                                <input type="number" id="analyticsDays" value="30">
                            </div>
                            <button class="btn" onclick="getAnalyticsOverview()">Get Overview</button>
                            <div id="analyticsResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>Emotion Analytics</h3>
                            <button class="btn" onclick="getEmotionAnalytics()">Get Emotion Stats</button>
                            <div id="emotionAnalyticsResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>Mood Trends</h3>
                            <button class="btn" onclick="getTrends()">Get Trends</button>
                            <div id="trendsResponse" class="response"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clinical Tab -->
            <div id="clinical" class="tab-content">
                <div class="section">
                    <h2>üè• Clinical Analytics & Healthcare Outcomes</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="getClinicalOverview()">Clinical Overview</button>
                        <button class="quick-btn" onclick="getClinicalAssessment()">AI Assessment</button>
                        <button class="quick-btn" onclick="getEvidenceBasedInsights()">Evidence-Based</button>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h3>Clinical Analytics Overview</h3>
                            <div class="form-group">
                                <label>Days:</label>
                                <input type="number" id="clinicalDays" value="30">
                            </div>
                            <button class="btn" onclick="getClinicalOverview()">Get Clinical Overview</button>
                            <div id="clinicalOverviewResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>AI Clinical Assessment</h3>
                            <div class="form-group">
                                <label>Timeframe:</label>
                                <select id="clinicalTimeframe">
                                    <option value="week">Week</option>
                                    <option value="month" selected>Month</option>
                                    <option value="all">All Time</option>
                                </select>
                            </div>
                            <button class="btn" onclick="getClinicalAssessment()">Generate Assessment</button>
                            <div id="clinicalAssessmentResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>Evidence-Based Insights</h3>
                            <button class="btn" onclick="getEvidenceBasedInsights()">Get Evidence-Based Insights</button>
                            <div id="evidenceBasedResponse" class="response"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Tab -->
            <div id="ai" class="tab-content">
                <div class="section">
                    <h2>ü§ñ AI Insights</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="generateInsights('week')">Week Insights</button>
                        <button class="quick-btn" onclick="generateInsights('month')">Month Insights</button>
                        <button class="quick-btn" onclick="generateInsights('all')">All Time</button>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h3>Generate AI Insights</h3>
                            <div class="form-group">
                                <label>Timeframe:</label>
                                <select id="insightTimeframe">
                                    <option value="week">Week</option>
                                    <option value="month">Month</option>
                                    <option value="all">All Time</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Focus:</label>
                                <select id="insightFocus">
                                    <option value="all">All</option>
                                    <option value="emotions">Emotions</option>
                                    <option value="journal">Journal</option>
                                    <option value="games">Games</option>
                                </select>
                            </div>
                            <button class="btn" onclick="generateInsights()">Generate Insights</button>
                            <div id="aiResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>AI Configuration</h3>
                            <div class="form-group">
                                <label>Google AI API Key:</label>
                                <input type="password" id="aiApiKey" placeholder="Enter your API key">
                            </div>
                            <button class="btn" onclick="setApiKey()">Set API Key</button>
                            <div class="form-group">
                                <label>Test AI Connection:</label>
                                <button class="btn btn-secondary" onclick="testAI()">Test AI</button>
                            </div>
                            <div id="aiConfigResponse" class="response"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Games Tab -->
            <div id="games" class="tab-content">
                <div class="section">
                    <h2>üéÆ Game Sessions</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="createGameSession('mindfulness', 15)">Mindfulness (15min)</button>
                        <button class="quick-btn" onclick="createGameSession('breathing', 10)">Breathing (10min)</button>
                        <button class="quick-btn" onclick="createGameSession('meditation', 20)">Meditation (20min)</button>
                    </div>

                    <div class="grid">
                        <div class="card">
                            <h3>Create Game Session</h3>
                            <div class="form-group">
                                <label>Game Type:</label>
                                <select id="gameType">
                                    <option value="mindfulness">Mindfulness</option>
                                    <option value="breathing">Breathing Exercise</option>
                                    <option value="meditation">Meditation</option>
                                    <option value="gratitude">Gratitude Journal</option>
                                    <option value="mood_tracker">Mood Tracker</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Duration (minutes):</label>
                                <input type="number" id="gameDuration" min="1" value="10">
                            </div>
                            <div class="form-group">
                                <label>Score (optional):</label>
                                <input type="number" id="gameScore" min="0" max="100" placeholder="0-100">
                            </div>
                            <div class="form-group">
                                <label>Emotion Before:</label>
                                <select id="gameEmotionBefore">
                                    <option value="">Auto-detect (latest emotion)</option>
                                    <option value="happy">Happy</option>
                                    <option value="sad">Sad</option>
                                    <option value="loneliness">Loneliness</option>
                                    <option value="anxiety">Anxiety</option>
                                    <option value="frustration">Frustration</option>
                                    <option value="stress">Stress</option>
                                    <option value="lethargy">Lethargy</option>
                                    <option value="fear">Fear</option>
                                    <option value="grief">Grief</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Emotion After:</label>
                                <select id="gameEmotionAfter">
                                    <option value="">AI will analyze</option>
                                    <option value="happy">Happy</option>
                                    <option value="sad">Sad</option>
                                    <option value="loneliness">Loneliness</option>
                                    <option value="anxiety">Anxiety</option>
                                    <option value="frustration">Frustration</option>
                                    <option value="stress">Stress</option>
                                    <option value="lethargy">Lethargy</option>
                                    <option value="fear">Fear</option>
                                    <option value="grief">Grief</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Completion Status:</label>
                                <select id="gameCompletionStatus">
                                    <option value="completed">Completed</option>
                                    <option value="incomplete">Incomplete</option>
                                    <option value="abandoned">Abandoned</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Notes:</label>
                                <textarea id="gameNotes" placeholder="How did it go?"></textarea>
                            </div>
                            <button class="btn" onclick="createGameSession()">Create Session</button>
                            <div id="gameResponse" class="response"></div>
                        </div>

                        <div class="card">
                            <h3>Get Game Sessions</h3>
                            <div class="form-group">
                                <label>Days:</label>
                                <input type="number" id="gameDays" value="30">
                            </div>
                            <button class="btn" onclick="getGameSessions()">Get Sessions</button>
                            <div id="gameListResponse" class="response"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5001/api';
        let currentClerkId = 'test_user_123';

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Connection and Auth
        async function checkHealth() {
            try {
                const response = await fetch('http://localhost:5001/health');
                const data = await response.json();
                
                document.getElementById('healthStatus').textContent = 'Connected';
                document.getElementById('healthStatus').className = 'status connected';
                document.getElementById('healthResponse').textContent = JSON.stringify(data, null, 2);
                document.getElementById('healthResponse').className = 'response success';
            } catch (error) {
                document.getElementById('healthStatus').textContent = 'Disconnected';
                document.getElementById('healthStatus').className = 'status disconnected';
                document.getElementById('healthResponse').textContent = 'Error: ' + error.message;
                document.getElementById('healthResponse').className = 'response error';
            }
        }

        function setAuth() {
            currentClerkId = document.getElementById('clerkId').value;
            document.getElementById('authStatus').textContent = 'Authenticated as: ' + currentClerkId;
            document.getElementById('authStatus').className = 'status connected';
        }

        // Helper function for API calls
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${currentClerkId}` // Using clerkId as token for testing
                }
            };
            
            const finalOptions = { ...defaultOptions, ...options };
            
            try {
                const response = await fetch(url, finalOptions);
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Emotions
        async function createEmotionEntry() {
            const emotion = document.getElementById('emotionType').value;
            const intensityInput = document.getElementById('emotionIntensity').value;
            const intensity = intensityInput ? parseInt(intensityInput) : undefined;
            const context = document.getElementById('emotionContext').value;

            const result = await apiCall('/emotions', {
                method: 'POST',
                body: JSON.stringify({
                    emotion,
                    intensity,
                    context: context || undefined
                })
            });

            document.getElementById('emotionResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('emotionResponse').className = result.success ? 'response success' : 'response error';
        }

        function createEmotion(emotion, intensity) {
            document.getElementById('emotionType').value = emotion;
            document.getElementById('emotionIntensity').value = intensity;
            createEmotionEntry();
        }

        async function getEmotions() {
            const days = document.getElementById('emotionDays').value;
            const emotion = document.getElementById('emotionFilter').value;
            
            let endpoint = `/emotions?days=${days}`;
            if (emotion) endpoint += `&emotion=${emotion}`;
            
            const result = await apiCall(endpoint);
            document.getElementById('emotionsListResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('emotionsListResponse').className = result.success ? 'response success' : 'response error';
        }

        async function getDailyEmotions() {
            const days = document.getElementById('emotionDays').value;
            const result = await apiCall(`/emotions/daily?days=${days}`);
            document.getElementById('emotionsListResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('emotionsListResponse').className = result.success ? 'response success' : 'response error';
        }

        // Journal
        async function createJournalEntry() {
            const mood = document.getElementById('journalMood').value;
            const content = document.getElementById('journalContent').value;
            const tags = document.getElementById('journalTags').value.split(',').map(t => t.trim()).filter(t => t);
            const isPrivate = document.getElementById('journalPrivate').checked;

            const result = await apiCall('/journal', {
                method: 'POST',
                body: JSON.stringify({
                    mood,
                    content,
                    tags,
                    isPrivate
                })
            });

            document.getElementById('journalResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('journalResponse').className = result.success ? 'response success' : 'response error';
        }

        function createJournal(mood, content) {
            document.getElementById('journalMood').value = mood;
            document.getElementById('journalContent').value = content;
            createJournalEntry();
        }

        async function getJournalEntries() {
            const days = document.getElementById('journalDays').value;
            const includePrivate = document.getElementById('journalPrivateFilter').value;
            
            const result = await apiCall(`/journal?days=${days}&includePrivate=${includePrivate}`);
            document.getElementById('journalListResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('journalListResponse').className = result.success ? 'response success' : 'response error';
        }

        async function searchJournal() {
            const query = prompt('Enter search query:');
            if (!query) return;
            
            const result = await apiCall(`/journal/search?q=${encodeURIComponent(query)}`);
            document.getElementById('journalListResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('journalListResponse').className = result.success ? 'response success' : 'response error';
        }

        // Analytics
        async function getAnalyticsOverview() {
            const days = document.getElementById('analyticsDays').value;
            const result = await apiCall(`/analytics/overview?days=${days}`);
            document.getElementById('analyticsResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('analyticsResponse').className = result.success ? 'response success' : 'response error';
        }

        async function getEmotionAnalytics() {
            const days = document.getElementById('emotionDays').value;
            const result = await apiCall(`/analytics/emotions?days=${days}`);
            document.getElementById('emotionAnalyticsResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('emotionAnalyticsResponse').className = result.success ? 'response success' : 'response error';
        }

        async function getTrends() {
            const days = document.getElementById('emotionDays').value;
            const result = await apiCall(`/analytics/trends?days=${days}`);
            document.getElementById('trendsResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('trendsResponse').className = result.success ? 'response success' : 'response error';
        }

        // Clinical Analytics
        async function getClinicalOverview() {
            const days = document.getElementById('clinicalDays').value;
            const result = await apiCall(`/clinical-analytics/overview?days=${days}`);
            document.getElementById('clinicalOverviewResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('clinicalOverviewResponse').className = result.success ? 'response success' : 'response error';
        }

        async function getClinicalAssessment() {
            const timeframe = document.getElementById('clinicalTimeframe').value;
            const result = await apiCall('/clinical-analytics/ai-assessment', {
                method: 'POST',
                body: JSON.stringify({
                    timeframe,
                    focus: 'all'
                })
            });
            document.getElementById('clinicalAssessmentResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('clinicalAssessmentResponse').className = result.success ? 'response success' : 'response error';
        }

        async function getEvidenceBasedInsights() {
            const days = document.getElementById('clinicalDays').value;
            const result = await apiCall(`/clinical-analytics/evidence-based-insights?days=${days}`);
            document.getElementById('evidenceBasedResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('evidenceBasedResponse').className = result.success ? 'response success' : 'response error';
        }

        // AI Insights
        async function generateInsights(timeframe = null) {
            const tf = timeframe || document.getElementById('insightTimeframe').value;
            const focus = document.getElementById('insightFocus').value;
            
            const result = await apiCall('/analytics/insights', {
                method: 'POST',
                body: JSON.stringify({
                    timeframe: tf,
                    focus
                })
            });

            document.getElementById('aiResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('aiResponse').className = result.success ? 'response success' : 'response error';
        }

        function setApiKey() {
            const apiKey = document.getElementById('aiApiKey').value;
            localStorage.setItem('google_ai_api_key', apiKey);
            document.getElementById('aiConfigResponse').textContent = 'API key saved!';
            document.getElementById('aiConfigResponse').className = 'response success';
        }

        async function testAI() {
            const result = await apiCall('/analytics/insights', {
                method: 'POST',
                body: JSON.stringify({
                    timeframe: 'week',
                    focus: 'all'
                })
            });

            document.getElementById('aiConfigResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('aiConfigResponse').className = result.success ? 'response success' : 'response error';
        }

        // Games
        async function createGameSession(gameType = null, duration = null) {
            const type = gameType || document.getElementById('gameType').value;
            const dur = duration || parseInt(document.getElementById('gameDuration').value);
            const score = document.getElementById('gameScore').value;
            const emotionBefore = document.getElementById('gameEmotionBefore').value;
            const emotionAfter = document.getElementById('gameEmotionAfter').value;
            const completionStatus = document.getElementById('gameCompletionStatus').value;
            const notes = document.getElementById('gameNotes').value;

            const body = {
                gameType: type,
                duration: dur,
                notes: notes || undefined,
                emotionBefore: emotionBefore || undefined,
                emotionAfter: emotionAfter || undefined,
                completionStatus: completionStatus || 'completed'
            };

            if (score) body.score = parseInt(score);

            const result = await apiCall('/games', {
                method: 'POST',
                body: JSON.stringify(body)
            });

            document.getElementById('gameResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('gameResponse').className = result.success ? 'response success' : 'response error';
        }

        async function getGameSessions() {
            const days = document.getElementById('gameDays').value;
            const result = await apiCall(`/games?days=${days}`);
            document.getElementById('gameListResponse').textContent = JSON.stringify(result, null, 2);
            document.getElementById('gameListResponse').className = result.success ? 'response success' : 'response error';
        }

        // Audio Journal Functions
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;

        function showJournalTab(tab) {
            // Hide all journal tab contents
            document.getElementById('textJournal').style.display = 'none';
            document.getElementById('audioJournal').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-small').forEach(t => t.classList.remove('active'));
            
            // Show selected tab and add active class
            if (tab === 'text') {
                document.getElementById('textJournal').style.display = 'block';
                document.querySelector('.tab-small:first-child').classList.add('active');
            } else if (tab === 'audio') {
                document.getElementById('audioJournal').style.display = 'block';
                document.querySelector('.tab-small:last-child').classList.add('active');
            }
        }

        async function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            const status = document.getElementById('recordingStatus');
            const createBtn = document.getElementById('createAudioBtn');

            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        // Create a file input to simulate file selection
                        const audioFile = document.getElementById('audioFile');
                        const dataTransfer = new DataTransfer();
                        const file = new File([audioBlob], 'recording.wav', { type: 'audio/wav' });
                        dataTransfer.items.add(file);
                        audioFile.files = dataTransfer.files;
                        
                        createBtn.disabled = false;
                    };

                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.textContent = '‚èπÔ∏è Stop Recording';
                    recordBtn.classList.add('recording');
                    status.textContent = 'Recording...';
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    status.textContent = 'Error: Could not access microphone';
                }
            } else {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
                recordBtn.textContent = 'üéôÔ∏è Start Recording';
                recordBtn.classList.remove('recording');
                status.textContent = 'Recording completed';
            }
        }

        async function createAudioJournalEntry() {
            const mood = document.getElementById('audioJournalMood').value;
            const tags = document.getElementById('audioJournalTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const isPrivate = document.getElementById('audioJournalPrivate').checked;
            const audioFile = document.getElementById('audioFile').files[0];

            if (!audioFile) {
                document.getElementById('journalResponse').textContent = 'Please select or record an audio file';
                document.getElementById('journalResponse').className = 'response error';
                return;
            }

            const formData = new FormData();
            formData.append('audio', audioFile);
            formData.append('mood', mood);
            formData.append('tags', JSON.stringify(tags));
            formData.append('isPrivate', isPrivate);

            try {
                const response = await fetch(`${API_BASE}/journal/audio`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${getCurrentClerkId()}`
                    },
                    body: formData
                });

                const result = await response.json();
                document.getElementById('journalResponse').textContent = JSON.stringify(result, null, 2);
                document.getElementById('journalResponse').className = result.success ? 'response success' : 'response error';

                if (result.success) {
                    // Clear form
                    document.getElementById('audioJournalTags').value = '';
                    document.getElementById('audioFile').value = '';
                    document.getElementById('createAudioBtn').disabled = true;
                    document.getElementById('recordingStatus').textContent = 'Ready to record';
                }
            } catch (error) {
                console.error('Audio journal creation error:', error);
                document.getElementById('journalResponse').textContent = 'Error: ' + error.message;
                document.getElementById('journalResponse').className = 'response error';
            }
        }

        // Enable audio upload when file is selected
        document.addEventListener('DOMContentLoaded', function() {
            const audioFileInput = document.getElementById('audioFile');
            if (audioFileInput) {
                audioFileInput.addEventListener('change', function() {
                    const createBtn = document.getElementById('createAudioBtn');
                    createBtn.disabled = !this.files.length;
                });
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkHealth();
            setAuth();
            
            // Load saved API key
            const savedKey = localStorage.getItem('google_ai_api_key');
            if (savedKey) {
                document.getElementById('aiApiKey').value = savedKey;
            }
        });
    </script>
</body>
</html> 